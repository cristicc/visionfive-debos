= Evaluation of StarFive VisionFive SBC
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:example-caption!:
:table-caption!:
:prewrap!:
:imagesdir: docs/img
:toc:
:toc-placement!:
:sectnums:
:sectanchors:
:sectlinks:
:PROJECT_NAME: visionfive-debos
:PROJECT_URL: https://github.com/cristicc/{PROJECT_NAME}
:PROJECT_DIR: ${HOME}/{PROJECT_NAME}
:OUTPUT_DIR: {PROJECT_DIR}/build

toc::[]

[IMPORTANT]
This is currently a work in progress.

== Intro

This is an experimental Debian based OS and application for the VisionFive SBC
from StarFive <<RefQuickStartQuide>>.

The main purpose of the project is to evaluate the mainline kernel support and
to find areas of further improvements.

== Boot process

ifdef::env-github[]
image::visionfive-boot-process.svg[]
endif::[]

ifndef::env-github[]
[ditaa]
----
/-----------\
|           |
|  BootROM  |
|      cCCC |
\-----+-----/
      |
      | Select boot source
      | ٭ UART ‑ Load a limited size binary into the on‑chip RAM and execute it
      |          (for upgrading firmware)
      | ٭ QSPI ‑ Automatically load the 32K Bootloader from 0x0 (NOR Flash)
      |          to 0x18000000 (RAM); jump to it for execution
      v
+-----------\      +----------------------+
|           |      | {d}                  |
| BootLoader|<--=--+ bootloader‑٭.bin.out |
|      cCDF |      |                 cFA7 |
\-----+-----+      +----------------------+
      |
      | Read DDRInit from 0x10000 (NOR Flash) to 0x18080000 (RAM);
      | jump to it for execution
      v
+-----------\      +----------------------+
|           |      | {d}                  |
|  DDRInit  |<--=--+  ddrinit‑٭.bin.out   |
|      cCDF |      |                 cFA7 |
\-----+-----+      +----------------------+
      |
      | Initialize DDR; read fw_payload (OpenSBI + U‑Boot) from 0x40000
      | (NOR Flash) to 0x80000000 (DDR); jump to it to execute the OpenSBI
      v
+-----------\      +----------------------+
|           |      | {d}                  |
|  OpenSBI  |<--=--+  fw_payload.bin.out  |
|      cCDF |      |                 cFA7 |
\-----+-----+      +----------------------+
      |
      | Provide basic system calls for Linux; switch the mode from M to S;
      | jump to 0x80020000 (DDR) to execute U‑Boot
      |
      v            +-----------------+
+-----------+      | {d}             |
|           |      |  ٭ u‑boot.bin   |
|  U‑Boot   |<--=--+  ٭ u‑boot.dtb   |
|      cGRE |      |  ٭ uEnv.txt     |
+-----+-----+      |            cFA7 |
      |            +-----------------+
      |
      | Works in S mode; contains basic file system and peripheral drivers
      | (GMAC, UART, QSPI, USB, SDIO, etc.); load GRUB 2 UEFI playload from
      | SDIO to 0xa0000000 and execute it via bootefi command
      v
+-----------+      +--------------------+
|           |      | {d}                |
|  GRUB 2   |<--=--+ ٭ grubriscv64.efi  |
|      cGRE |      | ٭ grub.cfg         |
+-----+-----+      |               cFA7 |
      |            +--------------------+
      |
      | Select one of the menu entries in grub.cfg and boot a Linux kernel
      | image, providing also a DT blob and initramfs
      |
      v            +------------------------------------+
+------------+     | {d}                                |
|            |     | ٭ vmlinuz‑6.0.0‑visionfive         |
|Linux Kernel|<--=-+ ٭ jh7100‑starfive‑visionfive‑v1.dtb|
|       cD54 |     | ٭ initrd.img‑6.0.0‑visionfive      |
+-----+------+     |                                cFA7|
      |            +------------------------------------+
      |
      | Initialize hardware, load drivers and mount root filesystem;
      | launch user space init process
      v
+-----------+      +--------------------+
|           |      | {d}                |
|  RootFS   |<--=--+ debian‑riscv64.img |
|      cPNK |      |               cFA7 |
+-----------+      +--------------------+
----
endif::[]

[bibliography]
== References
* [[[RefQuickStartQuide,1]]] https://doc-en.rvspace.org/VisionFive/Quick_Start_Guide/VisionFive_QSG/specifications.html
* [[[RefStarfiveRepo,2]]] https://github.com/starfive-tech/VisionFive
